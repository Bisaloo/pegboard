---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# pegboard

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/pegboard)](https://CRAN.R-project.org/package=pegboard)
[![Travis build status](https://travis-ci.com/carpentries/pegboard.svg?branch=main)](https://travis-ci.com/carpentries/pegboard)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/carpentries/pegboard?branch=main&svg=true)](https://ci.appveyor.com/project/carpentries/pegboard)
[![Codecov test coverage](https://codecov.io/gh/carpentries/pegboard/branch/main/graph/badge.svg)](https://codecov.io/gh/carpentries/pegboard?branch=main)
[![R build status](https://github.com/carpentries/pegboard/workflows/R-CMD-check/badge.svg)](https://github.com/carpentries/pegboard/actions)
<!-- badges: end -->

> [pegboard] is tempered hardboard which is pre-drilled with evenly spaced
> holes. The holes are used to accept pegs or hooks to support various items,
> such as tools in a workshop.
>
> https://en.wikipedia.org/wiki/Pegboard

The {pegboard} package is a way to explore the Carpentries' lessons via their
XML representation. This package makes heavy use of rOpenSci's [{tinkr}](https://docs.ropensci.org/tinkr/) and [{xml2}](https://cran.r-project.org/package=xml2). 

There are two [{R6}](https://cran.r-project.org/package=R6) objects in the
package:

 - Episode: stores the xml content of a single episode
 - Lesson: stores all Episodes within a lesson

## Installation

This package is currently in development, but you can install it via {remotes}:

``` r
if (!requireNamespace("remotes", quietly = TRUE)) install.packages("remotes")
remotes::install_github("carpentries/pegboard")
```

## Example
 
The first way to get started is to use the `get_lesson()` function, which will
use [{git2r}](https://cran.r-project.org/package=git2r) to clone a lesson 
repository to your computer. 

```{r example, message = FALSE}
library(pegboard)
library(purrr)
library(xml2)
library(fs)

d <- fs::file_temp(pattern = "U2CREADME")
rng <- get_lesson("swcarpentry/r-novice-gapminder", path = d)
rng

# Find all challenges
head(rng$challenges())

# Find all solutions
head(rng$solutions())

# Find all discussion blocks
head(rng$blocks(".discussion"))
```

## Lesson Manipulation

You can isolate all of the specialized block quotes in the lesson with
`isolate_blocks()`. 

```{r isolate_blocks}
fun <- rng$episodes$`10-functions.Rmd`
fun$body %>% xml_length()
fun$isolate_blocks()$body %>% xml_length()
fun$write(d, format = "Rmd")
cat(readLines(fs::path(d, fun$name), n = 50)[(2 + length(fun$yaml)):50], sep = "\n")
```

## Roxygen-style blocks

One experiment we are trying is to create a new formatting for challenge blocks
that we think may be easier to write for folks. To convert lessons to this new
format, we can use `$unblock()`, for example, here's a challenge block that 
was reformatted to remove the 

```{r unblock}
cat(readLines(fs::path(d, fun$name), n = 70)[(27 + length(fun$yaml)):70], sep = "\n")
fun$challenges
fun$unblock(token = "#'")
fun$challenges
fun$code
fun$code[3] %>% xml_text() %>% cat()
```


## Reset

All changes can be reset to the initial state with the `$reset()` method:

```{r reset}
fun$reset()
fun$write(d, format = "Rmd")
cat(readLines(fs::path(d, fun$name), n = 50)[(2 + length(fun$yaml)):50], sep = "\n")
```

